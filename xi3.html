<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta name="format-detection" content="telephone=no">
<meta content="320" name="MobileOptimized">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name=description content=e帮鞋>
<meta name=keywords content=e帮鞋>
<title>e帮鞋-洗鞋</title>
<link rel=stylesheet href="css/style.css">
<link rel=stylesheet href="css/xi.css">
</head>
<body>
	<div class="wrap">
		<header id="header" class="bg" style="position:relative;">
            <div class="city">
              <a target="_self" href="index.html">
                <h6>< 返回</h6>
              </a>
            </div>
            光面
        </header>
        <ul class="nav">
            <li data-index=0>
                <div>光面</div>
                <span>0</span>
            </li>
            <li data-index=1>
                <div>网面</div>
                <span>0</span>
            </li>
            <li data-index=2>
                <div>翻毛</div>
                <span>0</span>
            </li>
            <li data-index=3>
                <div>磨砂</div>
                <span>0</span>
            </li>
        </ul>


    <div id="wrapper">
        <div id="scroller">
            <div class="list">
                <ul style="display:block">
                    <li>
                        <div class="left">
                            <img src="images/94.jpg" alt="光面" width="80" height="80">
                        </div>
                        <div class="right">
                            <p>布面网面旅游鞋清洗</p>
                            <dl>
                                <dt>
                                    <p>
                                        <span class="red">￥</span>
                                        <span class="red spanType1">10</span>/件
                                        <span class="org spanType2">6.7折</span>
                                    </p>
                                    <p>
                                        <span class="spanType3">原价￥15元</span>
                                    </p>
                                </dt>
                                <dd>
                                    <div class="add-sub">
                                        <div class="sub"></div>
                                        <div class="text">0</div>
                                        <div class="add" data-index=0></div>
                                    </div>
                                </dd>
                            </dl>
                        </div>
                    </li>

                    
                    <li>
                        <div class="left">
                            <img src="images/94.jpg" alt="光面" width="80" height="80">
                        </div>
                        <div class="right">
                            <p>布面网面旅游鞋清洗</p>
                            <dl>
                                <dt>
                                    <p>
                                        <span class="red">￥</span>
                                        <span class="red spanType1">10</span>/件
                                        <span class="org spanType2">6.7折</span>
                                    </p>
                                    <p>
                                        <span class="spanType3">原价￥15元</span>
                                    </p>
                                </dt>
                                <dd>
                                    <div class="add-sub">
                                        <div class="sub"></div>
                                        <div class="text">0</div>
                                        <div class="add" data-index=0></div>
                                    </div>
                                </dd>
                            </dl>
                        </div>
                    </li>

                    <li>
                        <div class="left">
                            <img src="images/94.jpg" alt="光面" width="80" height="80">
                        </div>
                        <div class="right">
                            <p>布面网面旅游鞋清洗</p>
                            <dl>
                                <dt>
                                    <p>
                                        <span class="red">￥</span>
                                        <span class="red spanType1">10</span>/件
                                        <span class="org spanType2">6.7折</span>
                                    </p>
                                    <p>
                                        <span class="spanType3">原价￥15元</span>
                                    </p>
                                </dt>
                                <dd>
                                    <div class="add-sub">
                                        <div class="sub"></div>
                                        <div class="text">0</div>
                                        <div class="add" data-index=0></div>
                                    </div>
                                </dd>
                            </dl>
                        </div>
                    </li>
                    <li>
                        <div class="left">
                            <img src="images/94.jpg" alt="光面" width="80" height="80">
                        </div>
                        <div class="right">
                            <p>布面网面旅游鞋清洗</p>
                            <dl>
                                <dt>
                                    <p>
                                        <span class="red">￥</span>
                                        <span class="red spanType1">10</span>/件
                                        <span class="org spanType2">6.7折</span>
                                    </p>
                                    <p>
                                        <span class="spanType3">原价￥15元</span>
                                    </p>
                                </dt>
                                <dd>
                                    <div class="add-sub">
                                        <div class="sub"></div>
                                        <div class="text">0</div>
                                        <div class="add" data-index=0></div>
                                    </div>
                                </dd>
                            </dl>
                        </div>
                    </li>
                    <li>
                        <div class="left">
                            <img src="images/94.jpg" alt="光面" width="80" height="80">
                        </div>
                        <div class="right">
                            <p>布面网面旅游鞋清洗</p>
                            <dl>
                                <dt>
                                    <p>
                                        <span class="red">￥</span>
                                        <span class="red spanType1">10</span>/件
                                        <span class="org spanType2">6.7折</span>
                                    </p>
                                    <p>
                                        <span class="spanType3">原价￥15元</span>
                                    </p>
                                </dt>
                                <dd>
                                    <div class="add-sub">
                                        <div class="sub"></div>
                                        <div class="text">0</div>
                                        <div class="add" data-index=0></div>
                                    </div>
                                </dd>
                            </dl>
                        </div>
                    </li>
                    <li>
                        <div class="left">
                            <img src="images/94.jpg" alt="光面" width="80" height="80">
                        </div>
                        <div class="right">
                            <p>布面网面旅游鞋清洗</p>
                            <dl>
                                <dt>
                                    <p>
                                        <span class="red">￥</span>
                                        <span class="red spanType1">10</span>/件
                                        <span class="org spanType2">6.7折</span>
                                    </p>
                                    <p>
                                        <span class="spanType3">原价￥15元</span>
                                    </p>
                                </dt>
                                <dd>
                                    <div class="add-sub">
                                        <div class="sub"></div>
                                        <div class="text">0</div>
                                        <div class="add" data-index=0></div>
                                    </div>
                                </dd>
                            </dl>
                        </div>
                    </li>
                    <li>
                        <div class="left">
                            <img src="images/94.jpg" alt="光面" width="80" height="80">
                        </div>
                        <div class="right">
                            <p>布面网面旅游鞋清洗</p>
                            <dl>
                                <dt>
                                    <p>
                                        <span class="red">￥</span>
                                        <span class="red spanType1">10</span>/件
                                        <span class="org spanType2">6.7折</span>
                                    </p>
                                    <p>
                                        <span class="spanType3">原价￥15元</span>
                                    </p>
                                </dt>
                                <dd>
                                    <div class="add-sub">
                                        <div class="sub"></div>
                                        <div class="text">0</div>
                                        <div class="add" data-index=0></div>
                                    </div>
                                </dd>
                            </dl>
                        </div>
                    </li>


                </ul>



               <ul>
                      <li>
                        <div class="left">
                            <img src="images/95.jpg" alt="光面" width="80" height="80">
                        </div>
                        <div class="right">
                            <p>布面网面旅游鞋清洗</p>
                            <dl>
                                <dt>
                                    <p>
                                        <span class="red">￥</span>
                                        <span class="red spanType1">10</span>/件
                                        <span class="org spanType2">6.7折</span>
                                    </p>
                                    <p>
                                        <span class="spanType3">原价￥15元</span>
                                    </p>
                                </dt>
                                <dd>
                                    <div class="add-sub">
                                        <div class="sub"></div>
                                        <div class="text">0</div>
                                        <div class="add" data-index=1></div>
                                    </div>
                                </dd>
                            </dl>
                        </div>
                    </li>

                    <li>
                        <div class="left">
                            <img src="images/95.jpg" alt="光面" width="80" height="80">
                        </div>
                        <div class="right">
                            <p>布面网面旅游鞋清洗</p>
                            <dl>
                                <dt>
                                    <p>
                                        <span class="red">￥</span>
                                        <span class="red spanType1">10</span>/件
                                        <span class="org spanType2">6.7折</span>
                                    </p>
                                    <p>
                                        <span class="spanType3">原价￥15元</span>
                                    </p>
                                </dt>
                                <dd>
                                    <div class="add-sub">
                                        <div class="sub"></div>
                                        <div class="text">0</div>
                                        <div class="add" data-index=1></div>
                                    </div>
                                </dd>
                            </dl>
                        </div>
                    </li>

                </ul>

               <ul>
                    <li>
                        <div class="left">
                            <img src="images/76.jpg" alt="光面" width="80" height="80">
                        </div>
                        <div class="right">
                            <p>布面网面旅游鞋清洗</p>
                            <dl>
                                <dt>
                                    <p>
                                        <span class="red">￥</span>
                                        <span class="red spanType1">10</span>/件
                                        <span class="org spanType2">6.7折</span>
                                    </p>
                                    <p>
                                        <span class="spanType3">原价￥15元</span>
                                    </p>
                                </dt>
                                <dd>
                                    <div class="add-sub">
                                        <div class="sub"></div>
                                        <div class="text">0</div>
                                        <div class="add" data-index=2></div>
                                    </div>
                                </dd>
                            </dl>
                        </div>
                    </li>
                </ul>
               <ul>
                    <li>
                        <div class="left">
                            <img src="images/78.jpg" alt="光面" width="80" height="80">
                        </div>
                        <div class="right">
                            <p>布面网面旅游鞋清洗</p>
                            <dl>
                                <dt>
                                    <p>
                                        <span class="red">￥</span>
                                        <span class="red spanType1">10</span>/件
                                        <span class="org spanType2">6.7折</span>
                                    </p>
                                    <p>
                                        <span class="spanType3">原价￥15元</span>
                                    </p>
                                </dt>
                                <dd>
                                    <div class="add-sub">
                                        <div class="sub"></div>
                                        <div class="text">0</div>
                                        <div class="add" data-index=3></div>
                                    </div>
                                </dd>
                            </dl>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
       
<footer id="footer"  class="bg">
    <nav>
           <a target="_self" href="index.html">
             <img width="38" height="38" src="images/shouye.png"/>
            </a>
           <a target="_self" href="order.html">
             <img width="38" height="38" src="images/luntan_1.png"/>
             <span style="display:none;">0</span>
           </a>
           <a target="_self" href="my.html">
             <img width="38" height="38" src="images/wode.png"/>
           </a>
           <a target="_self" href="my.html">
             <img width="38" height="38" src="images/shouye.png"/>
           </a>
      </nav>
</footer>

</div>
    <script src="js/islider.js"></script>
    <script src="js/iscroll.js"></script>
    <script src="js/zepto.min.js"></script>
    <script>
        $(function(){

            // 1、交互逻辑开始
            // 上面的导航 光、网、翻、磨分别对应从上排列的ul

            /*******
                 
                 根据不同的hash来定位不同的菜单

            ********/
           function log(content){
              console.log && console.log(content);
           }
           var 
                   myScroll = new IScroll('#wrapper', { 
                                bounceEasing: 'elastic',
                                bounceTime: 1200,
                                fadeScrollbars:true,//是否渐隐滚动条，关掉可以加速
                                scrollbars:true}),
                    hash = window.location.hash,
                    navLi = $(".nav li"),
                    listUl = $(".list ul"),
                    hash = hash.substring(1,hash.length),
                    header = $("#header"),
                    eventType = "touchstart",
                    // eventType = "touchstart",
                    navA = $('a[href="order.html"]'),
                    navSpan = navA.find("span"),
                    data = JSON.parse(localStorage.getItem("data")),
                    i = len = 0,
                    orderList = order = addClass =null,
                    TYPE_G = 0,TYPE_W = 1,TYPE_F = 2,TYPE_M = 3;//光面0，网面1，翻毛2，磨砂3
               
               //在进入选择页面之后，首先访问本地存储，看看有没有值，若有值
               //就把值取出来，赋值到 tab、footer、text上
               if(data){
                  if(data.clickCount){
                    navSpan.addClass("tips");
                    navSpan.html(data.clickCount);
                  }
                  orderList = data.orderList;
                  for(len = orderList.length;i<len;i++){
                     order = orderList[i];
                     addClass = $(navLi[order.type]).find("span");
                     if(order.count){
                        addClass.addClass("tips");
                        addClass.html(order.count);
                        var lu = $(listUl[order.type]);
                        lu.find(".sub")[0].style.visibility="visible";
                        lu.find(".text")[0].style.visibility="visible";
                        lu.find(".text")[0].innerHTML=order.count;
                     }
                  }
               }
               //若没有任何订单则footer中的去往订单导航不可用
               navA.on(eventType,function(){
                  data = JSON.parse(localStorage.getItem("data"));//获取新的data，不然得刷新一下
                  if(data&&!data.clickCount){
                    alert('您还没有任何订单');
                    return false;
                  }
               })
               /**
               *
               *是否刷新？默认为false
               *
               */         
               function tab(hash,isRefresh){
                    isRefresh = isRefresh || false;
                    hash = +hash || TYPE_G;
                    navLi.find("div").removeClass("selct");
                    $(navLi[hash]).find("div").addClass("selct");
                    listUl.css("display","none");
                    listUl[hash].style.display="block";
                    var html = "<div class='city'><a target='_self' href='index.html'><h6>< 返回</h6></a></div>";
                    switch(hash){
                        case TYPE_W:header.html(html+"网面");break;
                        case TYPE_F:header.html(html+"翻毛");break;
                        case TYPE_M:header.html(html+"磨砂");break;
                        default:header.html(html+"光面");
                    }
                    isRefresh && myScroll.refresh();
               }
               tab(hash);
               navLi.on(eventType,function(e){
                    var target = e.target;
                    if(target === this){
                        hash = target.dataset.index; 
                    }else{
                        hash = e.target.parentNode.dataset.index;
                    }
                    tab(hash,true);
               })

               //交互2：点击 + 号，改变dom
                listUl.find(".add").each(function() {
                    var
                        _this = $(this),
                        text = _this.prev(),
                        index = this.dataset.index,
                        sub = text.prev(),
                        navLiSpan = $($(".nav li span")[index]);
                    _this.on(eventType,function(){
                        var curValue = text.text(),
                            clickCount = $('a[href="order.html"] span').text(),
                            count = navLiSpan.text();
                        clickCount++;
                        curValue++;
                        count++;
                        text.css("visibility","visible");
                        sub.css("visibility","visible");
                        text.html(curValue);
                        navLiSpan.addClass("tips");
                        navSpan.addClass("tips");
                        navLiSpan.html(count);
                        navSpan.html(clickCount);
                        // log("index:"+index+" count:"+count+" curValue:"+curValue+" clickCount:"+clickCount);
                        save(index,count);
                    })
                })
                //交互3：点击 - 号，改变dom
                listUl.find(".sub").each(function() {
                    var 
                        _this = $(this),
                        text = _this.next(),
                        index = text.next()[0].dataset.index,
                        navLiSpan = $($(".nav li span")[index]);
                    _this.on(eventType,function(){
                        var curValue = _this.next().text(),
                            clickCount = $('a[href="order.html"] span').text(),
                            count = navLiSpan.text();
                        curValue--;
                        count--;
                        clickCount--;
                        if(!curValue){
                            text.css("visibility","hidden");
                            _this.css("visibility","hidden");
                        }else{
                            text.css("visibility","visible");
                            _this.css("visibility","visible");
                        }
                        text.html(curValue);
                        if(!count){
                           navLiSpan.removeClass("tips");
                        }else{
                           navLiSpan.addClass("tips");
                        }
                        navLiSpan.html(count);
                        if(!clickCount){
                           navSpan.removeClass("tips");
                        }else{
                           navSpan.addClass("tips"); 
                        }
                        navSpan.html(clickCount);
                        save(index,count);
                    })
                })
            //本地订单存储
            // 在分类二级页面中，类型不同、数量不同的订单


/**
*
* 存入本地存储中的数据格式为：
*  
* {
    total:220,     //所有类型的总价格
    clickCount:14, //所有类型的鞋子总数，即footer中的圆圈数
    orderList:     //一种鞋子的集合既是一个order，此为order的集合
    [
      {
        type:TYPE_G, //鞋子属于那种类型 0为光面、1为网面、2为翻毛、3位磨砂
        count:20, //该类型的个数，20双光面鞋子
        total:300 //此order多少钱？ 20双光面鞋子 X 单价 ---> 20 x 15 = 300
      },
      {
        type:2
        count:2,
        total:40
      }
    ]
  }
*
  要更新的是：点击 + 号、- 号 要实时更新本地存储
  index:type,count:tab,curValue:currentValue,clickCount:footer  
*/
function save (type,count) {
   type = +type || 0;
   count = +count || 0;
   var 
     data = JSON.parse(localStorage.getItem("data")),
     total = allTotal = clickCount = i = len = val = 0,
     orderList = order = newOrder = null,
     isInOrderList = false,
     getVal = function(type){//根据不同的类型返回不同的单价
       switch(type){
        case 0 :return 10;
        case 1 :return 15;
        case 2 :return 20;
        case 3 :return 25;}
     },
     getTotal = function(type,count){ //根据不同类型的鞋子数x单价 得出同类鞋子集合的总价
       val = getVal(type);
       switch(type){
        case 0 :return count*val;
        case 1 :return count*val;
        case 2 :return count*val;
        case 3 :return count*val;}
     };
   if(data){
     orderList = data.orderList; //不同类型鞋子的集合
     for(len = orderList.length;i<len;i++){ //循环结合
       order = orderList[i];
       if(order.type === type){ // 若本次要存储的存在于本地存储，则更新订单中的count、total
          order.count = count;
          order.total = getTotal(type,count);
          isInOrderList = true;
       }
     }
     if(!isInOrderList){//若本次要存储的不存在，则push新订单
       newOrder = {
                    "type":type,
                    "count":count,
                    "total":getTotal(type,count)
                  }
       orderList.push(newOrder);
     }
     //循环最新的orderList,计算出总价与总数并更新到对象上
    for(i = 0,len = orderList.length;i<len;i++){
      order = orderList[i];
      allTotal += order.total;
      clickCount += order.count;
    }
    data.allTotal = allTotal;
    data.clickCount = clickCount;
   }else{ //若没有本地存储
     total = allTotal = getTotal(type,count); //因为是第一次存储，所以总价等于集合价
     data = 
          {
            "allTotal":allTotal,
            "clickCount":clickCount,
            "orderList":
            [
              {
                "type":type,
                "count":count,
                "total":total
              }
            ]
          };
   }
   localStorage.setItem("data",JSON.stringify(data)); //更新本地存储
}
 })
    </script>
</body>
</html>